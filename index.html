<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>3D Real Dragon — Galaxy</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  #app{position:fixed;inset:0}
  .hud{position:fixed;left:10px;bottom:10px;color:#cfe2ff;background:rgba(10,14,35,.55);
       border:1px solid rgba(150,180,255,.25);border-radius:12px;padding:8px 10px;font-size:12px;backdrop-filter:blur(6px)}
</style>
</head>
<body>
<div id="app"></div>
<div class="hud">এক আঙুলে ঘোরাও · দুই আঙুলে জুম · ড্রাগন উড়বে/দুলবে · তারার মাঝে গ্যালাক্সি ✨</div>

<script type="module">
import * as THREE from "https://unpkg.com/three@0.158.0/build/three.module.js";
import { OrbitControls } from "https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js";
import { GLTFLoader } from "https://unpkg.com/three@0.158.0/examples/jsm/loaders/GLTFLoader.js";

// ---------- Renderer / Scene / Camera ----------
const el = document.getElementById("app");
const renderer = new THREE.WebGLRenderer({ antialias:true, powerPreference:"high-performance" });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;
el.appendChild(renderer.domElement);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0, 1.2, 6);

// ---------- Lights ----------
const hemi = new THREE.HemisphereLight(0x88bbff, 0x0a0a18, 0.8);
scene.add(hemi);

const dir = new THREE.DirectionalLight(0xffffff, 1.0);
dir.position.set(5, 8, 3);
scene.add(dir);

const rim = new THREE.PointLight(0x66aaff, 0.8, 40);
rim.position.set(-6, 2, -4);
scene.add(rim);

// ---------- Stars (parallax points) ----------
function makeStars(n, spread, size){
  const g = new THREE.BufferGeometry();
  const p = new Float32Array(n*3);
  for(let i=0;i<n;i++){
    p[i*3+0] = (Math.random()-0.5)*spread;
    p[i*3+1] = (Math.random()-0.5)*spread*0.6;
    p[i*3+2] = (Math.random()-0.5)*spread;
  }
  g.setAttribute("position", new THREE.BufferAttribute(p, 3));
  const m = new THREE.PointsMaterial({ color:0xffffff, size, sizeAttenuation:true, transparent:true, opacity:0.9 });
  return new THREE.Points(g, m);
}
scene.add(makeStars(2000, 300, 0.02));

// ---------- 3D Dragon (GLTF) ----------
const loader = new GLTFLoader();
// ওপেন-লাইসেন্স glTF স্যাম্পল ড্রাগন মডেল:
const DRAGON_URL = "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DragonAttenuation/glTF/DragonAttenuation.gltf";

let dragon, clock = new THREE.Clock();
loader.load(DRAGON_URL, (gltf) => {
  dragon = gltf.scene;
  // মডেল সামান্য নীল টিন্ট ও এমিসিভ গ্লো
  dragon.traverse(o=>{
    if(o.isMesh){
      o.castShadow = o.receiveShadow = true;
      if(o.material && o.material.color) {
        o.material.color.offsetHSL(0.55, 0.1, 0.05); // নীলাভ
        if("emissive" in o.material) {
          o.material.emissive = new THREE.Color(0x0a2a6a);
          o.material.emissiveIntensity = 0.25;
        }
      }
    }
  });
  dragon.scale.set(1.2,1.2,1.2);
  dragon.position.set(0, 0, 0);
  dragon.rotation.set(0, Math.PI, 0); // সামনে তাকানো
  scene.add(dragon);
}, undefined, (err) => {
  console.error(err);
  const t = document.createElement("div");
  t.style.cssText = "position:fixed;left:10px;top:10px;color:#ffb3b3;background:#330;padding:6px 8px;border-radius:8px;font-size:12px";
  t.textContent = "মডেল লোড হয়নি (নেটওয়ার্ক/CORS)। পরে আবার রিফ্রেশ দিন।";
  document.body.appendChild(t);
});

// ---------- Controls ----------
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.minDistance = 2.5;
controls.maxDistance = 12;
controls.target.set(0,0.6,0);

// ---------- Animate (fly/bob) ----------
let t = 0;
function animate(){
  requestAnimationFrame(animate);
  const dt = clock.getDelta();
  t += dt;

  // ড্রাগনের ফ্লাইট-পাথ (ধীরে বৃত্তে ঘুরে + দোল)
  if (dragon){
    const R = 2.2;
    const speed = 0.4;                // উড়ার গতি
    dragon.position.x = Math.cos(t*speed) * R;
    dragon.position.z = Math.sin(t*speed) * R;
    dragon.position.y = Math.sin(t*1.8) * 0.25 + 0.3;
    // দিক অনুযায়ী ঘোরানো
    const lookAt = new THREE.Vector3(
      Math.cos((t+0.02)*speed)*R,
      dragon.position.y,
      Math.sin((t+0.02)*speed)*R
    );
    dragon.lookAt(lookAt);
  }

  controls.update();
  renderer.render(scene, camera);
}
animate();

// ---------- Resize ----------
addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
